<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Function & Tangent Grapher</title>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 600px; margin: auto; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; font-size: 1rem; }
    #plot { height: 500px; }
    #error { color: red; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Graph Function and Tangent</h2>
  <input id="functionInput" placeholder="Enter function, e.g. x^2 + 3x">
  <input id="xValueInput" placeholder="Enter x value, e.g. 2">
  <button onclick="plotFunction()">Plot</button>
  <div id="error"></div>
  <div id="plot"></div>

  <script>
    function plotFunction() {
      const expr = document.getElementById("functionInput").value;
      const xVal = parseFloat(document.getElementById("xValueInput").value);
      const errorDiv = document.getElementById("error");
      errorDiv.textContent = ""; // clear previous errors

      try {
        const f = math.parse(expr).compile();
        const derivative = math.derivative(expr, 'x').compile();

        const yVal = f.evaluate({ x: xVal });
        const slope = derivative.evaluate({ x: xVal });

        if (!isFinite(yVal) || !isFinite(slope)) {
          throw new Error("Function or derivative is undefined at x = " + xVal);
        }

        const x = math.range(xVal - 10, xVal + 10, 0.1).toArray();
        const y = x.map(xi => f.evaluate({ x: xi }));
        const tangentY = x.map(xi => slope * (xi - xVal) + yVal);

        const trace1 = { x: x, y: y, type: 'scatter', name: 'Function' };
        const trace2 = { x: x, y: tangentY, type: 'scatter', name: 'Tangent Line' };

        Plotly.newPlot('plot', [trace1, trace2], { margin: { t: 20 } });
      } catch (err) {
        errorDiv.textContent = "Error: " + err.message;
        Plotly.purge('plot');
      }
    }
  </script>
</body>
</html>
